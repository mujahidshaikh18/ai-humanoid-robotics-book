---
sidebar_position: 4
title: 'Chapter 4: URDF & Humanoid Robot Description'
---

# URDF & Humanoid Robot Description

## Overview

This chapter explores the Unified Robot Description Format (URDF), which is essential for describing robot kinematics, dynamics, and visual properties. We'll focus specifically on how URDF applies to humanoid robots and their complex joint structures.

## Learning Objectives

By the end of this chapter, you will be able to:
- Understand the structure and components of URDF files
- Create URDF descriptions for humanoid robots
- Define kinematic chains and joint constraints
- Incorporate visual and collision properties
- Validate and visualize URDF models

## Introduction to URDF

URDF (Unified Robot Description Format) is an XML-based format used to describe robot models in ROS. It defines the physical and visual properties of a robot, including its links, joints, and their relationships.

### Basic URDF Structure

A basic URDF file consists of links and joints:

```xml
<?xml version="1.0"?>
<robot name="simple_robot">
  <!-- Links define rigid bodies -->
  <link name="base_link">
    <visual>
      <geometry>
        <box size="0.5 0.5 0.2"/>
      </geometry>
    </visual>
    <collision>
      <geometry>
        <box size="0.5 0.5 0.2"/>
      </geometry>
    </collision>
    <inertial>
      <mass value="1.0"/>
      <inertia ixx="0.1" ixy="0.0" ixz="0.0" iyy="0.1" iyz="0.0" izz="0.1"/>
    </inertial>
  </link>

  <link name="upper_arm">
    <visual>
      <geometry>
        <cylinder length="0.5" radius="0.05"/>
      </geometry>
    </visual>
    <collision>
      <geometry>
        <cylinder length="0.5" radius="0.05"/>
      </geometry>
    </collision>
    <inertial>
      <mass value="0.5"/>
      <inertia ixx="0.01" ixy="0.0" ixz="0.0" iyy="0.01" iyz="0.0" izz="0.005"/>
    </inertial>
  </link>

  <!-- Joints connect links -->
  <joint name="shoulder_joint" type="revolute">
    <parent link="base_link"/>
    <child link="upper_arm"/>
    <origin xyz="0.0 0.0 0.3" rpy="0 0 0"/>
    <axis xyz="0 1 0"/>
    <limit lower="-1.57" upper="1.57" effort="100" velocity="1"/>
  </joint>
</robot>
```

## Link Elements

Links represent rigid bodies in the robot. Each link contains visual, collision, and inertial properties.

### Visual Properties

Visual elements define how the link appears in visualization tools:

```xml
<link name="link_name">
  <visual>
    <origin xyz="0 0 0" rpy="0 0 0"/>
    <geometry>
      <!-- Choose one geometry type -->
      <box size="0.1 0.1 0.1"/>
      <!-- OR -->
      <cylinder radius="0.05" length="0.2"/>
      <!-- OR -->
      <sphere radius="0.05"/>
      <!-- OR -->
      <mesh filename="package://my_robot_description/meshes/link_name.stl"/>
    </geometry>
    <material name="blue">
      <color rgba="0 0 1 1"/>
    </material>
  </visual>
</link>
```

### Collision Properties

Collision elements define the collision geometry for physics simulation:

```xml
<link name="link_name">
  <collision>
    <origin xyz="0 0 0" rpy="0 0 0"/>
    <geometry>
      <box size="0.1 0.1 0.1"/>
    </geometry>
  </collision>
</link>
```

### Inertial Properties

Inertial elements define the mass and moment of inertia properties:

```xml
<link name="link_name">
  <inertial>
    <mass value="1.0"/>
    <origin xyz="0 0 0" rpy="0 0 0"/>
    <inertia ixx="0.1" ixy="0.0" ixz="0.0" iyy="0.1" iyz="0.0" izz="0.1"/>
  </inertial>
</link>
```

## Joint Elements

Joints define the connections between links and their degrees of freedom.

### Joint Types

1. **Fixed**: No movement between links
2. **Revolute**: Single-axis rotation with limits
3. **Continuous**: Single-axis rotation without limits
4. **Prismatic**: Single-axis translation with limits
5. **Planar**: Movement on a plane
6. **Floating**: 6 DOF movement

```xml
<joint name="joint_name" type="revolute">
  <parent link="parent_link"/>
  <child link="child_link"/>
  <origin xyz="0.1 0 0" rpy="0 0 0"/>
  <axis xyz="0 0 1"/>
  <limit lower="-1.57" upper="1.57" effort="100" velocity="1"/>
  <dynamics damping="0.1" friction="0.0"/>
</joint>
```

## Humanoid Robot URDF

Humanoid robots have complex kinematic structures with multiple limbs. Here's a simplified example of a humanoid torso:

```xml
<?xml version="1.0"?>
<robot name="humanoid_torso">
  <!-- Torso -->
  <link name="torso">
    <visual>
      <geometry>
        <box size="0.3 0.2 0.5"/>
      </geometry>
      <material name="gray">
        <color rgba="0.5 0.5 0.5 1"/>
      </material>
    </visual>
    <collision>
      <geometry>
        <box size="0.3 0.2 0.5"/>
      </geometry>
    </collision>
    <inertial>
      <mass value="10.0"/>
      <inertia ixx="0.5" ixy="0.0" ixz="0.0" iyy="0.6" iyz="0.0" izz="0.2"/>
    </inertial>
  </link>

  <!-- Head -->
  <link name="head">
    <visual>
      <geometry>
        <sphere radius="0.1"/>
      </geometry>
      <material name="skin">
        <color rgba="0.8 0.6 0.4 1"/>
      </material>
    </visual>
    <collision>
      <geometry>
        <sphere radius="0.1"/>
      </geometry>
    </collision>
    <inertial>
      <mass value="2.0"/>
      <inertia ixx="0.02" ixy="0.0" ixz="0.0" iyy="0.02" iyz="0.0" izz="0.02"/>
    </inertial>
  </link>

  <!-- Neck joint -->
  <joint name="neck_joint" type="revolute">
    <parent link="torso"/>
    <child link="head"/>
    <origin xyz="0.0 0.0 0.3" rpy="0 0 0"/>
    <axis xyz="0 1 0"/>
    <limit lower="-0.5" upper="0.5" effort="10" velocity="1"/>
  </joint>

  <!-- Left Shoulder -->
  <link name="left_shoulder">
    <visual>
      <geometry>
        <cylinder radius="0.05" length="0.1"/>
      </geometry>
      <material name="gray"/>
    </visual>
    <collision>
      <geometry>
        <cylinder radius="0.05" length="0.1"/>
      </geometry>
    </collision>
    <inertial>
      <mass value="1.0"/>
      <inertia ixx="0.001" ixy="0.0" ixz="0.0" iyy="0.001" iyz="0.0" izz="0.002"/>
    </inertial>
  </link>

  <joint name="left_shoulder_joint" type="revolute">
    <parent link="torso"/>
    <child link="left_shoulder"/>
    <origin xyz="0.15 0.0 0.2" rpy="0 0 0"/>
    <axis xyz="0 1 0"/>
    <limit lower="-1.57" upper="1.57" effort="50" velocity="1"/>
  </joint>

  <!-- Left Upper Arm -->
  <link name="left_upper_arm">
    <visual>
      <geometry>
        <cylinder radius="0.04" length="0.3"/>
      </geometry>
      <material name="gray"/>
    </visual>
    <collision>
      <geometry>
        <cylinder radius="0.04" length="0.3"/>
      </geometry>
    </collision>
    <inertial>
      <mass value="1.5"/>
      <inertia ixx="0.01" ixy="0.0" ixz="0.0" iyy="0.01" iyz="0.0" izz="0.001"/>
    </inertial>
  </link>

  <joint name="left_elbow_joint" type="revolute">
    <parent link="left_shoulder"/>
    <child link="left_upper_arm"/>
    <origin xyz="0.0 0.0 -0.15" rpy="0 0 0"/>
    <axis xyz="0 0 1"/>
    <limit lower="-1.57" upper="1.57" effort="30" velocity="1"/>
  </joint>
</robot>
```

## Xacro for Complex URDFs

Xacro (XML Macros) allows you to create more maintainable and parameterized URDF files:

```xml
<?xml version="1.0"?>
<robot xmlns:xacro="http://www.ros.org/wiki/xacro" name="humanoid_with_xacro">

  <!-- Properties -->
  <xacro:property name="M_PI" value="3.1415926535897931" />
  <xacro:property name="arm_length" value="0.3" />
  <xacro:property name="arm_radius" value="0.04" />

  <!-- Macro for arm segments -->
  <xacro:macro name="arm_segment" params="name parent xyz length radius">
    <link name="${name}">
      <visual>
        <geometry>
          <cylinder radius="${radius}" length="${length}"/>
        </geometry>
        <material name="gray">
          <color rgba="0.5 0.5 0.5 1"/>
        </material>
      </visual>
      <collision>
        <geometry>
          <cylinder radius="${radius}" length="${length}"/>
        </geometry>
      </collision>
      <inertial>
        <mass value="1.0"/>
        <inertia ixx="0.01" ixy="0.0" ixz="0.0" iyy="0.01" iyz="0.0" izz="0.001"/>
      </inertial>
    </link>

    <joint name="${name}_joint" type="revolute">
      <parent link="${parent}"/>
      <child link="${name}"/>
      <origin xyz="${xyz}" rpy="0 0 0"/>
      <axis xyz="0 0 1"/>
      <limit lower="-1.57" upper="1.57" effort="30" velocity="1"/>
    </joint>
  </xacro:macro>

  <!-- Base link -->
  <link name="base_link">
    <visual>
      <geometry>
        <box size="0.2 0.2 0.2"/>
      </geometry>
    </visual>
    <inertial>
      <mass value="5.0"/>
      <inertia ixx="0.1" ixy="0.0" ixz="0.0" iyy="0.1" iyz="0.0" izz="0.1"/>
    </inertial>
  </link>

  <!-- Use the macro to create arm segments -->
  <xacro:arm_segment name="upper_arm" parent="base_link" xyz="0.0 0.0 0.2" length="${arm_length}" radius="${arm_radius}"/>

</robot>
```

## URDF Validation and Tools

### Checking URDF Syntax

Validate your URDF files using the check_urdf tool:

```bash
ros2 run urdf check_urdf /path/to/robot.urdf
```

### Visualizing URDF

Use rviz2 to visualize your robot model:

```bash
ros2 run rviz2 rviz2
```

In RViz, add a RobotModel display and set the Robot Description parameter to your URDF topic.

### Joint State Publisher

To visualize URDF with moving joints, use the joint_state_publisher:

```bash
ros2 run joint_state_publisher joint_state_publisher
```

## Humanoid-Specific Considerations

### Kinematic Chains

Humanoid robots typically have multiple kinematic chains:
- Left arm: torso → shoulder → upper arm → lower arm → hand
- Right arm: torso → shoulder → upper arm → lower arm → hand
- Left leg: torso → hip → thigh → shank → foot
- Right leg: torso → hip → thigh → shank → foot

### Degrees of Freedom

Humanoid robots require many degrees of freedom to mimic human motion:

```xml
<!-- Example: 7 DOF arm -->
<joint name="shoulder_yaw" type="revolute">
  <axis xyz="0 0 1"/>
  <limit lower="-2.0" upper="2.0" effort="50" velocity="1"/>
</joint>
<joint name="shoulder_pitch" type="revolute">
  <axis xyz="0 1 0"/>
  <limit lower="-2.0" upper="1.5" effort="50" velocity="1"/>
</joint>
<joint name="shoulder_roll" type="revolute">
  <axis xyz="1 0 0"/>
  <limit lower="-3.0" upper="3.0" effort="50" velocity="1"/>
</joint>
```

### Balance and Stability

When designing humanoid URDFs, consider:
- Center of mass positioning
- Foot contact points for stability
- Proper mass distribution

## Integration with ROS 2

### Publishing Static Transforms

Use robot_state_publisher to publish static transforms from URDF:

```python
import rclpy
from rclpy.node import Node
from geometry_msgs.msg import TransformStamped
from tf2_ros import TransformBroadcaster
import tf2_ros
import geometry_msgs.msg
import rclpy.qos

class URDFPublisher(Node):
    def __init__(self):
        super().__init__('urdf_publisher')

        # Publish static transforms from URDF
        self.br = tf2_ros.StaticTransformBroadcaster(self)

        # Load URDF and publish transforms
        self.publish_urdf_transforms()

    def publish_urdf_transforms(self):
        # This would typically be handled by robot_state_publisher
        # but you can manually publish transforms if needed
        pass

def main(args=None):
    rclpy.init(args=args)
    publisher = URDFPublisher()
    rclpy.spin(publisher)
    rclpy.shutdown()

if __name__ == '__main__':
    main()
```

## Best Practices

1. **Start Simple**: Begin with a basic model and add complexity gradually
2. **Validate Frequently**: Use check_urdf to validate as you build
3. **Use Xacro**: For complex robots, use Xacro to avoid duplication
4. **Realistic Inertias**: Use realistic mass and inertia values for simulation
5. **Collision vs Visual**: Keep collision geometry simple for performance
6. **Naming Conventions**: Use consistent, descriptive names for links and joints

## Summary

This chapter covered the fundamentals of URDF and how to describe humanoid robots. We explored the structure of URDF files, the importance of visual and collision properties, and how to use Xacro for complex models. Understanding URDF is crucial for working with humanoid robots in ROS 2, as it forms the basis for all kinematic and dynamic calculations.

In the next chapter, we'll explore how to integrate AI agents with ROS using rclpy.